<%@page import="notice.N_C_DAO"%>
<%@page import="java.util.HashMap"%>
<%@page import="follow.FollowVO"%>
<%@page import="follow.FollowDAO"%>
<%@page import="result.ResultVO"%>
<%@page import="result.ResultDAO"%>
<%@page import="notice.NoticeVO"%>
<%@page import="java.util.List"%>
<%@page import="notice.NoticeDAO"%>
<%@page import="team.TeamVO"%>
<%@page import="member.MemberVO"%>
<%@page import="team.TeamDAO"%>
<%@page import="member.MemberDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title> HomeGround :: MainPage </title>
<style type="text/css">
h3 {position: relative;}
h3 span {position: absolute; right: 0; font-size:15px;}
</style>

<link rel= "stylesheet" href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" >
<link rel ="stylesheet" href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" >
<script src= "https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" ></script >
<script src= "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" ></script >
<script type="text/javascript">
	
	$(function(){
		$("td:first-child").css("font-weight","bold");
	})
		
	
	function logout() {		
		location.href="logout.jsp";		
	}	

</script>

<%
	MemberDAO 	memberDao	 		= 	new MemberDAO();
	TeamDAO   	teamDao 			= 	new TeamDAO();
	NoticeDAO 	noticeDao			= 	new NoticeDAO();
	ResultDAO	resultDao			= 	new ResultDAO();
	FollowDAO	followDao 			= 	new FollowDAO();
	N_C_DAO		noticeCommentDao	=	new N_C_DAO();
	
	String memId				=   (String)session.getAttribute("memId");
	int	   teamNo				= 	(Integer)session.getAttribute("teamNo");
	//userVo.getTeamNo()
	MemberVO 	userVo			= 	memberDao.getMemberInfoById(memId);
	TeamVO 		userTeamVo 		= 	teamDao.getTeamByNo(userVo.getTeamNo());

	String		userName		= 	userVo.getName();
	String 		coachName 		= 	teamDao.getTeamCoachName(userTeamVo.getCoachNo());
	int 		teamCount		= 	memberDao.getAllMemberCountByTeamNo(teamNo);
	
	FollowVO	teamFollowVo;
	int			follower		= 	0;
	int			following		=	0;
	if(followDao.getFollowerNumAndFollowingNum(teamNo) != null){
		teamFollowVo = followDao.getFollowerNumAndFollowingNum(teamNo);
		follower	 = teamFollowVo.getFollower();
		following	 = teamFollowVo.getFollowing();
	}
	
	System.out.println(teamNo);

	HashMap<String, Object> range = new HashMap<String, Object>();
	range.put("startNo", 1);
	range.put("endNo", 5);
	range.put("teamNo", teamNo);
	
	List<NoticeVO> noticeList 	= (List)noticeDao.getNoticeRange(range);
	List<ResultVO> resultList 	= (List)resultDao.getResultByRange(1, 5, teamNo);
	
%>


</head>
<body>

<!-- 팀정보  -->

<div class="container">

	<!-- 네비게이션 -->
	<nav class="navbar navbar-inverse">	
	    <div class="navbar-header">
	      <a class="navbar-brand" href="mainPage.jsp">홈 그라운드</a>
	    </div>
	    <div>
	      <ul class="nav navbar-nav">
	        <li class="active"><a href="#"> 팀명 :<strong><%=userTeamVo.getName() %></strong></a></li>			        
	      </ul>
	      <p class="navbar-text"><strong><%=userName %></strong>님 안녕하세요. 환영합니다.</p>
	     
	      <button type="button" class="btn btn-danger navbar-btn" onclick="logout()">로그아웃</button>
	      	
	      <form class="navbar-form navbar-left" role="search" method="post" action="otherTeamPage.jsp">
	        <div class="form-group">
	          <input type="text" class="form-control" name="searchTeamName" placeholder="팀명을 검색하세요">
	        </div>
	        <button type="submit" class="btn btn-default">검색</button>
	      </form>
	      
	      	
	   </div>
	</nav>
	

	<div class="row">	
			
		<div class="col-md-4">	
			<h3> 사진 </h3>		
			<img src="<%=userTeamVo.getPhoto() %>" class="img-rounded" alt="Main Team Image" width="304" height="236"> 
			
		</div>
		<div class="col-md-8">
			<h3>팀정보</h3>
			<p> 감독명 : <%=coachName %> </p>
			<p> 인원수 : <%=teamCount %> </p>
			<p> 전적 : [없음] </p>
			<p> 지역 : <%=userTeamVo.getArea() %></p>
			<p> 창단일 : <%=userTeamVo.getRegdate() %></p>
			<p> 팀소개 : <%=userTeamVo.getIntroduce() %></p>
			<div class="btn-group btn-group-justified">
				<a href="teamMemberList.jsp?teamNo=<%=teamNo %>" class="btn btn-default"> 인원 보기 </a>
				<a href="#" class="btn btn-default"> 팔로워 : <%=follower %> </a>
				<a href="#" class="btn btn-default"> 팔로잉 : <%=following %> </a> 
				<a href="#" class="btn btn-primary"> 프로필 수정 </a> <!-- 상대팀에 왔을때는 팔로잉 하기! -->	
			</div>
		</div>			
	</div>
	
	<hr/>
	
	<div class="row">
		<div class="col-md-6">
			<h3>공지 사항<span><a href="notice/noticeList.jsp?teamNo=<%=teamNo %>&pno=1">더보기</a></span></h3>			
			<table class="table table-hover">
				<thead>
					<tr>
						<th>공지 번호  </th>
						<th>제목  </th>
						<th>작성자  </th>
						<th>날짜  </th>	
					</tr>				
				</thead>
				<tbody>
				<% for (int i=0; i<noticeList.size(); i++) { %>
				<% int commentCnt = noticeCommentDao.commentCount(noticeList.get(i).getNo() ,teamNo ); %>
					<tr>
						<td><span class="label label-danger">공지</span> <%=noticeList.get(i).getNo() %></td>
						<td><%=noticeList.get(i).getTitle() %> <% if(commentCnt != 0){ %> [<%=commentCnt %>] <%} %></td>
						<td>감 독</td>
						<td><%=noticeList.get(i).getStrDate() %></td>
					</tr>
				<%} %>
				</tbody>
			</table>
		</div>
		
		<div class="col-md-6">
			<h3>경기 결과<span><a href="matchResult/resultList.jsp?teamNo=<%=teamNo %>">더보기</a></span></h3>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>경기 글 번호  </th>
						<th>제목  </th>
						<th>날짜  </th>	
					</tr>				
				</thead>
				<tbody>
				<% for (int i=0; i<resultList.size(); i++) { 
				
					String myTeam 	  = resultDao.getTeamNameByNo(resultList.get(i).getMyTeamNo());
					String rivaleTeam = resultDao.getTeamNameByNo(resultList.get(i).getRivalTeamNo());
					
				%>
				
					<tr>
						<td><span class="label label-warning">경기결과</span> <%=resultList.get(i).getGameNo() %></td>
						<td><a href="matchResult/resultDetail.jsp?pno=1&no=<%=resultList.get(i).getGameNo() %>&teamNo=<%=teamNo %>" ><%=myTeam %> <%=resultList.get(i).getMyRuns() %> vs 
							<%=resultList.get(i).getRivalRuns() %> <%=rivaleTeam %></a> </td>
						<td><%=resultList.get(i).getStrDate() %></td>
					</tr>
				<%} %>				
				</tbody>
			</table>
		</div>
		
		<div class="row">
		<div class="col-md-6">
			<h3>자유 게시판<span><a href="board/boardList.jsp?teamNo=<%=teamNo %>">더보기</a></span></h3>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>게시판 번호  </th>
						<th>제목  </th>
						<th>작성자  </th>
						<th>날짜  </th>	
					</tr>				
				</thead>
				<tbody>
				<% for (int i=0; i<5; i++) { %>
					<tr>
						<td><span class="label label-primary">자게</span> <%=i %></td>
						<td>심심하다..놀아줘 </td>
						<td>곽태민</td>
						<td>2015-06-18 PM9:12</td>
					</tr>
				<%} %>
				</tbody>
			</table>
		</div>
		
		<div class="col-md-6">
			<h3>팔로우 게시판<span><a href="#">더보기</a></span></h3>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>팔로우 글 번호  </th>
						<th>제목  </th>
						<th>작성자  </th>
						<th>날짜  </th>	
					</tr>				
				</thead>
				<tbody>
				<% for (int i=0; i<5; i++) { %>
					<tr>
						<td><span class="label label-success">팔로글</span> <%=i %></td>
						<td>우아아아아아 </td>
						<td>조약돌</td>
						<td>2015-06-18 PM9:12</td>
					</tr>
				<%} %>				
				</tbody>
			</table>
		</div>
		
	</div>
	
</div>





</body>
</html>